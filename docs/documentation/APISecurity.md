## API Security
Keyed-Hash Message Authentication Code (HMAC) is used to simultaneously verify both the data integrity and the authentication of a message. **Client Key** is mandatory for every transaction and is to be sent as the value for HTTP header **Api-Key**. HMAC is generated by the client using the **Client Secret** provided and is sent as part of Authorization header in the format **HMAC {generatedHmac}**. The Server validates the request by regenerating the HMAC using the secret assigned to the Api Key. The HMAC has a validity of 300 seconds i.e. the timestamp used as part of the request to generate the HMAC should not be older that the said time.

Each client will be assigned a unique Key Pair of Client Key & Client Secret and shared by First Data team.

## HMAC Calculation

The following are the steps to calculate the HMAC.
* If payload is not empty, hash the payload using SHA-256 and encode using Base64.
* Concatenate the API Key, Timestamp and Hashed payload (only if applicable) separated by colon ( : ) character.
* Generate a HMAC for the concatenated message with API Secret using SHA-256 algorithm and encode using Base64.

``` java
import java.security.MessageDigest;
import java.util.Base64;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class HmacUtil {

    private static final String CT_CLN = ":";
    private static final String MD_ALG = "SHA-256";
    private static final String HMAC_ALG = "HmacSHA256";

    public static String generateHmac(final String apiKey, final String apiSecret, final String epochTimestamp,
            final String payload) throws Exception {
        final StringBuffer stringBuffer = new StringBuffer();
        stringBuffer.append(apiKey).append(CT_CLN).append(epochTimestamp);
        if ((payload != null) && !payload.trim().equals("")) {
            final byte[] hash = MessageDigest.getInstance(MD_ALG).digest(payload.getBytes());
            final String encPyld = Base64.getEncoder().encodeToString(hash);
            stringBuffer.append(CT_CLN).append(encPyld);
        }
        final String messageToSign = stringBuffer.toString();
        final Mac hmac = Mac.getInstance(HMAC_ALG);
        final SecretKeySpec key = new SecretKeySpec(apiSecret.getBytes(), HMAC_ALG);
        hmac.init(key);
        return Base64.getEncoder().encodeToString(hmac.doFinal(messageToSign.getBytes()));
    }
}
```
