<meta charset="UTF-8">
<meta name="description" content="Create an Account  for uCom">
<meta name="keywords" content="uCom, Customer Services, Account Services, Nonce Token">

# Tokenize an Account with a Nonce Token

## Description

Tokenize an account without an associated uCom customer identifier. 
The token will be generated by the system configured in the merchants setup.

You can enable direct communication between mobile applications and uCom
and pavoid PCI compliance needs for the merchant application server. The PCI
data flows directly between mobile applications and uCom and does not, at any point in
communication, touch the merchant application server or flow through the merchant
application server.

The credit card information used in the application (e.g. GooglePay) must be attached to an active account.
Nonce – A secure random number.

Use this method to do transactions using the Google Pay API which allows customers to pay with any credit or debit card stored in their Google account. 
Supported transaction types are - 'authorize' & 'purchase'
https://developer.payeezy.com/payeezy-api/apis/post/transactions-19

(define 3DS transactions) https://developer.payeezy.com/payeezy-api/apis/post/transactions-19

### Tokens 

Tokens are useful when storing the details of a customer’s payment instruments to secure and speed up checkout later. 
When you collect a customer's payment methods, you can request a token, which you can then use in place of a customer’s card 
details to execute future payments. You will need to store the token on your platform, mapped to the customer’s account details.

Tokens are useful as they reduce the risk of attacks on your and our payments systems being successful. 
Tokenisation also reduces the PCI Requirement for you, as it means you don't need to store card details within your systems, 
which should reduce your costs associated with PCI Compliance.

To generate a Token for future use at the same time as submitting a payment, use the createToken object 
to set a Token up for multiple use (set reusable to True). In addition, you can create your own token for the merchant, 
send it to us within the object, and set rules as to whether you want to decline payments with duplicate payment details.

<!-- Reference: https://docs.fiserv.com/docs/payments/ZG9jOjMzMzI5MTk-tokens -->
<!-- GooglePay Reference: https://docs.fiserv.com/docs/payments/ZG9jOjMzMzI5MjM-google-pay -->
<!-- Reference: https://docs.fiserv.com/docs/payments/ZG9jOjQ3NzY3NzY-sequence-diagram -->

Example: 
``` json
"tokenType":"CLAIM_CHECK_NONCE"
```

Exmaple nonce: "ab12-124C-ab12-124C-ab12-124C"

### Recipe, e.g. Use Case Example
A simple Card Payment.

1. Generate a message signature
2. Configure the body
3. Submit the request
   https://docs.fiserv.dev/public/recipes/make-a-card-payment


![Account Services Process](../../../../assets/images/AccountServicesProcess.png)

# Prerequisite
It is important that you see the - [Create a Customer Profile](https://dev-developerstudio.fiserv.com/product/UniversalCommerce/docs/?path=docs/documentation/customerServicesCreateCustomer_v1.md&branch=develop)
because you need the *fdCustomerId* to create an account.

# Endpoint
POST /v1/customers/{fdCustomerId}/accounts
POST /v1/customers/${cuid}/accounts

POST /v1/account-tokens?access_token=${acctoken}

<!-- {cuid} is {fdCustomerId} --> 
<!-- /v1/partners/${partnerid}/customers/${cuid}/accounts --> 
<!-- POST https://ucom-account-services-qa.apps.us-oma1-np2.1dc.com/v1/partners/POPEYES/customers/5ef1cb33899a4fc190919382b41b5992/accounts -->

# Authentication

Basic Authentication

# Request Headers

<details> 
   <summary>Click to expand!</summary> 

| HEADER                  | VALUE                                                      | DESCRIPTION                        |
|-------------------------|------------------------------------------------------------|------------------------------------|
| Connection              | keep-alive                                                 | The Keep-Alive general header allows the sender to hint about how the connection may be used to set a timeout and a maximum amount of requests.        |
| skipValidation          | Y                                                          |                                                                                                                                                        | 
| Content-Type            | application/json                                           | Content Type of request message/payload. Supported values: application/json;charset=UTF-8.                                                             |
| Client-Request-Id       | e.g., m2qpjzcx                                             | A client-generated ID for request tracking and signature creation, unique per request. This is also used for idempotency control. Recommended 128-bit UUID format.   |
| X-Wallet-Id             | e.g., Company name_WALLET                                  | A card wallet account ID associated with a given payment instrument identification.  |
| X-B3-TraceId            | e.g., 7a317b88b71f56ba                                     | The Trace ID to the Database call for Real Time Credit Card Transactions.                               |
| X-B3-SpanId             | e.g., 84261b82bd7f74d9                                     |                                |
| Content-Length          | e.g., 1274                                                 |                                |
| Host                    | e.g., ucom-customer-services-prd.apps.us-[server name].com |                                |
| User-Agent              | e.g., Apache-HttpClient/4.5.12 (Java/17.0.2)               |                                |
| Authorization           | e.g., Basic dWNvbS1hcGlnZWU6dWNvbS1hcGlnZWU=               | HMAC Key generation, Base64 HMAC SHA256 of authentication headers and request body. Authorization header is required to have the HMAC string capitalized and followed by one space followed by the calculated HMAC signature. |

</details>

# Request Body

<details> 
   <summary>Click to expand!</summary> 

<!-- The Request body is defined in the YAML API specification file: https://firstdatanp-ucomgateway.apigee.io/apis/ucomcustomerservices/index -->
<!-- https://escmstash.1dc.com/projects/UC/repos/ucom_swagger/browse/swagger_definitions/uComCustomerServices.yaml -->
<!-- https://escmstash.1dc.com/projects/UC/repos/ucom_swagger/browse/sample_messages -->


https://firstdatanp-ucomgateway.apigee.io/#/accounts/post_v1_account_tokens

**Add a Models for Account Services and compare to the YAML files


| Variable                            | Type     | Example or Description                                                                                                      | Required Y/N         |
|-------------------------------------|----------|-----------------------------------------------------------------------------------------------------------------------------| -------------------- |
| **fdCustomerId**                    | string   | Example: ${cuid}. A unique identifier for subsequent operations like vaulting a payment account and making mobile payments. | Y |
| account:type                        | string   | ?what are the different types besides Credit?                                                                               | Y | 
| account:credit:cardNumber           | string   | description                                                                                                                 | Y | 
| account:credit:nameOnCard           | string   | description                                                                                                                 | Y | 
| account:credit:cardType             | string   | e.g., VISA, MasterCard, American Express, GooglePay, ApplePay, Discover, girocard, JCB, Maestro, SEPA, UnionPay             | Y | 
| account:credit:billingAddress       | string   | description                                                                                                                 | Y | 
| account:credit:billingAddress:type  | string   | e.g., work                                                                                                                  | Y | 
| account:credit:billingAddress:streetAddress  | string   | description                                                                                                                 | Y | 
| cardNumber                          | string   | description                                                                                                                 | Y | 

<!-- describe Wallet vs card number, is it for a wallet? "walletType": "EncryptedGooglePayWalletPaymentMethod" -->

https://firstdatanp-ucomgateway.apigee.io/#/

### json example

```json
{  
	"fdCustomerId":"${cuid}",
   "account":{  
      "type":"CREDIT",
      "credit":{  
         "cardNumber":"ENC_[${Output2}]",
         "nameOnCard":"John Smith",
         "cardType":"${cardtype}",
         "billingAddress":{  
            "type":"work",
            "streetAddress":"100 Universal City Plaza",
            "locality":"${city}",
            "region":"${state}",
            "postalCode":"${AVS}",
            "country":"${country}",
            "formatted":"100 Universal City Plaza\nHollywood, CA 91608 US",
            "primary":true
         },
         "expiryDate":{  
            "month":"ENC_[${Output3}]",
            "year":"ENC_[${Output4}]"         
            		 },
         "securityCode":"ENC_[${Output5}]"      
         }
   },
   "referenceToken":{  
      
      "tokenType":"CLAIM_CHECK_NONCE"
   },
  "deviceInfo":{  
      "id":"537edec8-d33e-4ee8-93a7-b9f61876950c",
      "kind":"mobile",
      "details":[  
         {  
            "provider":"InAuth",
            "dataCapture":{  
               "rawData":"aaaaaXREUVZGRlFY...aMV",
               "dataEventId":"BB8E4E92...Fz1E063113",
               "captureTime":"2016-04-16T16:06:05Z"
            }
         }
      ]
   }
}


```
</details>

# Request Cookies

[No cookies] 

# Response Headers

<details> 
   <summary>Click to expand!</summary>

    HTTP/1.1 201 Created
    Cache-Control: no-cache, no-store, max-age=0, must-revalidate
    Content-Security-Policy: default-src 'self';  'strict-dynamic'; frame-ancestors 'none','self'
    Content-Type: application/json
    Date: Fri, 17 Jun 2022 16:40:04 GMT
    Expires: 0
    Pragma: no-cache
    Strict-Transport-Security: max-age=31536000 ; includeSubDomains
    X-Content-Type-Options: nosniff
    X-Frame-Options: SAMEORIGIN
    X-Response-Id: a1592898-613e-4b4e-8d51-c5b92b9ed550
    X-Vcap-Request-Id: 7c296d49-223a-4d06-4bcc-7cccc03716e3
    X-Xss-Protection: 1; mode=block
    Transfer-Encoding: chunked
    Set-Cookie: NSC_VT-PNB1-OQ2-1ED-DPN-443-WJQ=ffffffff09bd36e445525d5f4f58455e445a4a42378b;path=/;secure;httponly                          
</details>

# Response Body
<details> 
   <summary>Click to expand!</summary> 

| Variable        | Type      | Example        | Description                        | 
|-----------------|-----------|----------------|------------------------------------|
|   id            | string    | Example: fdCustomerId                     | Unique identifier for a customer profile registered with uCom; and example is fdCustomerId for the Vault.                 |
|   externalId    | string    | Example: 123abc456def890ghi098jkl765mno   | Unique identifier for a customer profile registered with uCom. If there is no externalID, the first time User is created, one is generated in the request. If an externalID already exists, then the logger creates this error message: "Record exist for the given externalCustomerId: " + createCustomerRequest.getExternalCustomerId()); |

```json

{"id":"5cab4ea317ec4877ab419ae3844a970a", 
"externalId":"dwkockyq"}  
```
</details>

# Response Cookies

Set-Cookie: NSC_VT-PNB1-OQ2-1ED-DPN-443-WJQ=ffffffff09bd36e445525d5f4f58455e445a4a42378b;path=/;secure;httponly

## HTTP Status Code and Reason Phrase

* Code = 200, message = "Customer profile retrieved successfully"
* Code = 400, message = "An exception occured while retrieving a Customer profile"
* Code = 500, message = "An internal server error occured"

### Example

```json
    {
  "code": "40000",
  "message": "Example Error",
  "category": "example",
  "developerInfo": {
    "developerMessage": "Invalid Message format in request payload",
    "moreInfo": "https://www.example.com/errors/40000",
    "fieldError": [
      {
        "field": "example id",
        "message": "exampleId is mandatory"
      }
    ]
  }
}
```

[![Try it out](../../../../assets/images/button.png)](../api/?type=post&path=/payments-vas/v1/tokens)

<!--
type: tab
-->

# See Also

- [Authentication](https://escmconfluence.1dc.com/display/GDSO/Authentication)
- [TPOC Use Case](https://escmconfluence.1dc.com/display/SMPTEP/Case+1%3A+User+profile+creation+and+update)
- [Payment Source](?path=docs/Resources/Guides/Payment-Sources/Source-Type.md)