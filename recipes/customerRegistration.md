
# How to Create, Read, Update and Delete Customer Profiles

<img title="customer profile" alt="Alt text" src="https://raw.githubusercontent.com/Fiserv/universal-commerce/develop/assets/images/Picture1.png">
This guide will cover all CRUD operations for customer profiles in the Connected Commerce (uCom) API.

## Create a Customer Profile

**<ins> Description </ins>**

Create a Customer Profile (Customer Registration)

Registering a customer in the Connected Commerce (uCom) system results in a unique identifier, 'fdCustomerId' that is used in subsequent operations like vaulting a payment account or making mobile payments. 

**<ins> Endpoint URL </ins>**

HTTP Method: POST

Non-prod: https://int.api.firstdata.com/ucom/v1/customers

Prod: https://prod.api.firstdata.com/ucom/v1/customers

**<ins> Parameters </ins>**

| **Name** | **Type** | **Description** |
| --- | --- | --- |
| externalId | String | Customer ID provided by the partner system. |
| familyName | String | Family name of the customer. |
| givenName | String | Given name of the customer. |
| middleName | String | Middle name of the customer. |
| emails.value | String | Email address - No Pattern validation |
| emails.primary | Boolean | boolean |
|  addresses.streetAddress |  String | Street Address |
|  addresses.localty |  String | Address localty (eg; Hollywood) |
| addresses.region |  String | Address region or state (eg; CA, NY, IL, NE) |
| addresses.postalCode |  String |  Address postalCode (eg: 68137) |
| addresses.country | String |  Address Country (eg: ISO-3166-1 "apha-2" code US, IN, CA, UK)|
| phoneNumbers,value | String |  e.g., 'tel:+1-201-555-0123' |
| phoneNumbers,type | String |  home, mobile |
| phoneNumbers,primary | Boolean |  primary = True/False |
| DeviceInfo | Object | Required for Fraud detect |

**<ins> HTTP Headers </ins>**

| Header Name | Required | Description |
| --- | --- | --- |
| Api-Key | Yes | Merchant API key |
| Timestamp | Yes | Request initiation UTC timestamp, formatted as Epoch time. The value is in milliseconds. Sample value format is 1499961987232 |
| Authorization | Yes | Authorization header is required to have the "HMAC" string capitalized and followed by one space followed by the calculated hmac signature. When using the /account-tokens API: **Authorization** : - Bearer \<tokenId\>\*Utilizes the tokenId returned from the /tokens api |
| Client-Request-Id | Yes | Contains a unique ID generated by the client that is used for enforcing idempotency on POST actions.  |
| Content-Type | Yes | application/json |
| access\_token | Conditionally | Required when vaulting payment information. Utilizes the tokenId returned from the /tokens api. |

**<ins> Sample Headers </ins>** </br>
Content-Type:application/json <br>
Client-Request-Id:{{$guid}} <br>
Api-Key:{{clientKey}} <br>
Authorization:HMAC {{signature}} <br>
Timestamp:{{time}} <br>

**<ins> Sample Request (Minimal information) </ins>**

```json
{
    "customer": {
        "externalId": "5876",
        "name": {
            "givenName": "Donald5876",
            "familyName": "Smith"
        },
        "emails": [
            {
                "value": "Smith5876@gmail.com"
            }
        ],
        "addresses": [
            {
                "streetAddress": "A27 Pacific Street",
                "locality": "Atlanta",
                "region": "GA",
                "postalCode": "00000"
            }
        ]
    }
}
```

**<ins> Sample Request (Additional Information) </ins>**


```json
{
    "customer": {
        "externalId": "5876",
        "name": {
            "givenName": "Donald5876",
            "familyName": "Smith",
            "middleName": "Gold",
            "honorificPrefix": "Mr",
            "honorificSuffix": "LL.D"
        },
        "emails": [
            {
                "value": "Smith5876@gmail.com"
            }
        ],
        "phoneNumbers": [
            {
                "value": "1234567892",
                "type": "mobile"
            }
        ],
        "addresses": [
            {
                "streetAddress": "A27 Pacific Street",
                "locality": "Atlanta",
                "region": "GA",
                "postalCode": "00000"
            }
        ]
    },
    "deviceInfo": {
        "id": "537edec8-d33e-4ee8-93a7-b9f61876950c",
        "kind": "mobile",
        "details": [
            {
                "provider": "RAVELIN",
                "dataCapture": {
                    "dataEventId": "537edec8-d33e-4ee8-93a7-b9f61876950c"
                }
            }
        ]
    }
}
```

**<ins> Sample Response (201 – Created) </ins>**

```json
{
    "id": "96328bee7fc64adc91e20064ca230e43",
    "externalId": "5876"
}
```
**<ins> Sample Response (400 – Bad Request)</ins>**

```json
{
    "code": "270101",
    "message": "Customer already registered.",
    "category": "customer",
    "developerInfo": {
        "developerMessage": "Customer already registered."
    }
}
```
## Update an Existing Customer Profile 

**<ins> Description </ins>**

This request will update the Customer profile in Connected Commerce (uCom) by providing the fdCustomerId.

**<ins> Endpoint URL </ins>**

HTTP Method: PATCH

Non-prod: https://int.api.firstdata.com/ucom/v1/customers/{fdCustomerId}

Prod: https://prod.api.firstdata.com/ucom/v1/customers/{fdCustomerId}


**<ins> Parameters </ins>**

| **Name** | **Type** | **Description** |
| --- | --- | --- |
| fdCustomerID | String | Customer ID provided by the partner system. |

\*This is always true for API flow.

**<ins> Headers </ins>**

Content-Type:application/json <br>
Client-Request-Id:{{$guid}} <br>
Api-Key:{{clientKey}} <br>
Authorization:HMAC {{signature}} <br>
Timestamp:{{time}} <br>

**<ins> Sample Request </ins>**

```json
{
    "customer": {
        "externalId": "5876",
        "emails": [
            {
                "value": "bjensen@example.com",
                "type": "work",
                "primary": true
            }
        ]
    }
}
```
This  request can update any entity that requires updating. Any of the objects or entities in the parameters (above) will work here.

**<ins> Sample Response (204 – No Content) </ins>**

The request succeeded but there's really nothing to show.

**<ins> Sample Response (400 – Bad Request) </ins>**
```json
{
    "code": "279904",
    "message": "Customer profile not found.",
    "category": "customer",
    "developerInfo": {
        "developerMessage": "Customer profile not found."
    }
}
```

## Read/Get Customer Profile

**<ins> Description </ins>**

Read a Customer Profile. Fetch the details of a customer providing the fdCustomerId.

**<ins> Endpoint URL </ins>**

HTTP Method: GET

Non-prod: https://int.api.firstdata.com/ucom/v1/customers/{fdCustomerId}

Prod: https://prod.api.firstdata.com/ucom/v1/customers/{fdCustomerId}

**<ins> Headers </ins>**

Content-Type:application/json <br>
Client-Request-Id:{{$guid}} <br>
Api-Key:{{clientKey}} <br>
Authorization:HMAC {{signature}} <br>
Timestamp:{{time}} <br>

**<ins> Sample Request </ins>**

This request is empty since it's a GET call. All that is needed is the fdCustomerId in the path or URL. 

**<ins> Sample Response (200 – Created) </ins>**

```json
{
    "id": "96328bee7fc64adc91e20064ca230e43",
    "externalId": "5876",
    "name": {
        "familyName": "Smith",
        "givenName": "Donald5876",
        "middleName": "Gold",
        "honorificPrefix": "Mr",
        "honorificSuffix": "LL.D"
    },
    "emails": [
        {
            "value": "Smith5876@gmail.com"
        }
    ],
    "addresses": [
        {
            "streetAddress": "A27 Pacific Street",
            "locality": "Atlanta",
            "region": "GA",
            "postalCode": "00000"
        }
    ],
    "phoneNumbers": [
        {
            "value": "1234567892",
            "type": "Mobile"
        }
    ]
}

```

**<ins> Sample Response (400 – Bad Request) </ins>**

```json
{
    "code": "279904",
    "message": "Customer profile not found.",
    "category": "customer",
    "developerInfo": {
        "developerMessage": "Customer profile not found."
    }
}
```

## Delete a Customer Profile

**<ins> Description </ins>**

Delete a customer profile from Connected Commerce (uCom) system by providing the fdCustomerId.

**<ins> Endpoint URL </ins>**

HTTP Method: DELETE

Non-prod: https://int.api.firstdata.com/ucom/v1/customers/{fdCustomerId}

Prod: https://prod.api.firstdata.com/ucom/v1/customers/{fdCustomerId}

**<ins> Headers </ins>**

Content-Type:application/json <br>
Client-Request-Id:{{$guid}} <br>
Api-Key:{{clientKey}} <br>
Authorization:HMAC {{signature}} <br>
Timestamp:{{time}} <br>
 
**<ins> Sample Request </ins>**

**<ins> Sample Response (204 – No Content) </ins>**

The request succeeded but there's nothing to show.

**<ins> Sample Response (400 – Bad Request) </ins>**

```json
{
    "code": "279904",
    "message": "Customer profile not found.",
    "category": "customer",
    "developerInfo": {
        "developerMessage": "Customer profile not found."
    }
}
```

```json
{
    "code": "270201",
    "message": "Customer profile details update failed",
    "category": "customer",
    "developerInfo": {
        "developerMessage": "Customer profile details update failed"
    }
}
```

```json
{
    "code": "400051",
    "message": "Missing Parameter",
    "category": "common",
    "developerInfo": {
        "developerMessage": "Missing Parameter",
        "fieldError": [
            {
                "field": "MerchantCustomerId",
                "message": "Invalid recipientId or merchant customer Id"
            }
        ]
    }
}
```



